<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Moto-Taxi City Adventure</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; background: #222; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; background: #444; } /* La route */
        #ui {
            position: fixed; top: 10px; left: 10px; color: white;
            background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px;
            pointer-events: none; z-index: 10;
        }
    </style>
</head>
<body>

<div id="ui">
    <div>ðŸ“¦ Livraisons: <span id="score">0</span></div>
    <div>â›½ Carburant: <span id="fuel">100</span>%</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- PARAMÃˆTRES DU JEU ---
let score = 0;
let fuel = 100;
let gameActive = true;

const player = {
    x: canvas.width / 2,
    y: canvas.height - 100,
    w: 30,
    h: 50,
    speed: 5
};

const objects = []; // Arbres, maisons, passants, bagages
const keys = {};

// --- GÃ‰NÃ‰RATION DES DÃ‰CORS ---
function createObject(type) {
    let side = Math.random() > 0.5 ? 'left' : 'right';
    let obj = {
        type: type,
        x: side === 'left' ? Math.random() * (canvas.width/2 - 60) : (canvas.width/2 + 60) + Math.random() * (canvas.width/2 - 60),
        y: -100,
        w: 40,
        h: 40,
        speed: 3
    };

    if(type === 'bagage') {
        obj.x = (canvas.width/2 - 40) + Math.random() * 80; // Sur la route
        obj.color = 'gold';
    } else if (type === 'passant') {
        obj.color = 'pink';
        obj.w = 20; obj.h = 20;
    } else {
        obj.color = type === 'arbre' ? 'green' : 'brown'; // Maison ou Arbre
    }
    objects.push(obj);
}

// Boucle pour crÃ©er des objets rÃ©guliÃ¨rement
setInterval(() => {
    if(!gameActive) return;
    let r = Math.random();
    if(r < 0.05) createObject('maison');
    else if(r < 0.15) createObject('arbre');
    else if(r < 0.18) createObject('passant');
    else if(r < 0.20) createObject('bagage');
}, 100);

// --- LOGIQUE ---
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

function update() {
    if(!gameActive) return;

    // DÃ©placement
    if(keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
    if(keys['ArrowRight'] && player.x < canvas.width - player.w) player.x += player.speed;
    
    fuel -= 0.05;
    document.getElementById('fuel').innerText = Math.floor(fuel);

    if(fuel <= 0) {
        gameActive = false;
        alert("Panne d'essence ! Score final: " + score);
        location.reload();
    }

    objects.forEach((obj, index) => {
        obj.y += obj.speed;

        // Collision avec le joueur
        if (player.x < obj.x + obj.w && player.x + player.w > obj.x &&
            player.y < obj.y + obj.h && player.y + player.h > obj.y) {
            
            if(obj.type === 'bagage') {
                score++;
                fuel = Math.min(100, fuel + 20);
                document.getElementById('score').innerText = score;
                objects.splice(index, 1);
            } else {
                // Collision avec dÃ©cor ou passant = ralentissement ou fin
                fuel -= 5;
                objects.splice(index, 1);
            }
        }

        // Nettoyer les objets sortis de l'Ã©cran
        if(obj.y > canvas.height) objects.splice(index, 1);
    });
}

// --- DESSIN ---
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Dessiner la route
    ctx.fillStyle = '#555';
    ctx.fillRect(canvas.width/2 - 70, 0, 140, canvas.height);
    
    // Ligne pointillÃ©e
    ctx.strokeStyle = 'white';
    ctx.setLineDash([20, 20]);
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, 0);
    ctx.lineTo(canvas.width/2, canvas.height);
    ctx.stroke();

    // Dessiner le joueur (Moto)
    ctx.fillStyle = '#00ffcc';
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Dessiner les objets (DÃ©cors, Passants, Bagages)
    objects.forEach(obj => {
        ctx.fillStyle = obj.color;
        if(obj.type === 'passant') {
            ctx.beginPath();
            ctx.arc(obj.x + 10, obj.y + 10, 10, 0, Math.PI*2);
            ctx.fill();
        } else {
            ctx.fillRect(obj.x, obj.y, obj.w, obj.h);
        }
    });

    requestAnimationFrame(() => {
        update();
        draw();
    });
}

draw();
</script>
</body>
</html>
